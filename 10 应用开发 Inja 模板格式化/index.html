<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="HADK 框架开发文档 - 跨端轻量级智能体开发框架"><meta name=author content=xufeng8@lenovo.com><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>Inja 模板格式化教程 - HADK</title><link rel=stylesheet href=../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=pink> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#inja class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=HADK class="md-header__button md-logo" aria-label=HADK data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> HADK </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Inja 模板格式化教程 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=pink aria-label=切换到深色模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换到深色模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=pink data-md-color-accent=pink aria-label=切换到浅色模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换到浅色模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../1%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%20Chat%20Node/ class=md-tabs__link> 基本概念 </a> </li> <li class=md-tabs__item> <a href=../6%20%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%20%E5%8D%95%E8%8A%82%E7%82%B9%E6%99%BA%E8%83%BD%E4%BD%93/ class=md-tabs__link> 应用开发 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=HADK class="md-nav__button md-logo" aria-label=HADK data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> HADK </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 基本概念 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 基本概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../1%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%20Chat%20Node/ class=md-nav__link> <span class=md-ellipsis> Chat Node </span> </a> </li> <li class=md-nav__item> <a href=../2%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%20Tool%20Node/ class=md-nav__link> <span class=md-ellipsis> Tool Node </span> </a> </li> <li class=md-nav__item> <a href=../3%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%20DIY%20Node/ class=md-nav__link> <span class=md-ellipsis> DIY Node </span> </a> </li> <li class=md-nav__item> <a href=../4%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%20%E8%B7%AF%E7%94%B1%20Route/ class=md-nav__link> <span class=md-ellipsis> 路由 Route </span> </a> </li> <li class=md-nav__item> <a href=../5%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%20%E9%93%BE%E5%92%8C%E6%B5%81%20Chain%20Flow/ class=md-nav__link> <span class=md-ellipsis> 链和流 Chain Flow </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> 应用开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 应用开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../6%20%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%20%E5%8D%95%E8%8A%82%E7%82%B9%E6%99%BA%E8%83%BD%E4%BD%93/ class=md-nav__link> <span class=md-ellipsis> 单节点智能体 </span> </a> </li> <li class=md-nav__item> <a href=../7%20%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%20%E5%8F%8C%E8%8A%82%E7%82%B9%E6%99%BA%E8%83%BD%E4%BD%93/ class=md-nav__link> <span class=md-ellipsis> 双节点智能体 </span> </a> </li> <li class=md-nav__item> <a href=../8%20%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%20%E4%B8%89%E8%8A%82%E7%82%B9%E6%99%BA%E8%83%BD%E4%BD%93/ class=md-nav__link> <span class=md-ellipsis> 三节点智能体 </span> </a> </li> <li class=md-nav__item> <a href=../9%20%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%20%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%E8%8A%82%E7%82%B9%E7%9A%84%E6%9D%A1%E4%BB%B6%E8%B7%AF%E7%94%B1%E6%99%BA%E8%83%BD%E4%BD%93/ class=md-nav__link> <span class=md-ellipsis> 指定工具的智能体 </span> </a> </li> <li class=md-nav__item> <a href="../10 应用开发 Inja 模板格式化教程.md" class=md-nav__link> <span class=md-ellipsis> Inja 模板格式化教程 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 概述 </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 基本用法 </span> </a> <nav class=md-nav aria-label=基本用法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 函数签名 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 模板语法 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 示例 </span> </a> <nav class=md-nav aria-label=示例> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> <span class=md-ellipsis> 示例1：简单的上下文格式化 </span> </a> </li> <li class=md-nav__item> <a href=#2-deepsearchcpp class=md-nav__link> <span class=md-ellipsis> 示例2：总结格式化（参考 deepsearch.cpp） </span> </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> <span class=md-ellipsis> 示例3：使用不同类型的变量 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 完整示例程序 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 支持的变量类型 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 错误处理 </span> </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 最佳实践 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 应用场景 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 参考资源 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=inja>Inja 模板格式化教程</h1> <h2 id=_1>概述</h2> <p>Inja 是一个功能强大的 C++ 模板引擎，HADK 框架通过 <code>ChatUtils::format_inja</code> 函数提供了便捷的模板格式化功能。使用 Inja 模板可以轻松地将变量值插入到模板字符串中，实现动态内容生成。</p> <h2 id=_2>基本用法</h2> <h3 id=_3>函数签名</h3> <pre><code class=language-c++>std::string ChatUtils::format_inja(
    const std::string&amp; template_str,
    const std::unordered_map&lt;std::string, std::any&gt;&amp; variables
);
</code></pre> <p><strong>参数说明：</strong> - <code>template_str</code>：模板字符串，使用 <code>{{变量名}}</code> 语法定义占位符 - <code>variables</code>：变量映射表，键为变量名，值为对应的变量值（支持多种类型）</p> <p><strong>返回值：</strong> - 格式化后的字符串</p> <h3 id=_4>模板语法</h3> <p>Inja 模板使用双大括号 <code>{{变量名}}</code> 来定义占位符，模板引擎会将占位符替换为对应的变量值。</p> <h2 id=_5>示例</h2> <h3 id=1>示例1：简单的上下文格式化</h3> <p>这是最基本的用法，展示如何使用字符串变量进行模板替换：</p> <pre><code class=language-c++>#include &lt;chat_utils.h&gt;
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;unordered_map&gt;
#include &lt;any&gt;

std::string simple_template = R&quot;(
你好，{{name}}！

今天是一个{{weather}}的{{time}}。

根据你的{{topic}}，我为你准备了以下内容：

{{content}}

希望这些信息对你有帮助！
)&quot;;

std::unordered_map&lt;std::string, std::any&gt; simple_variables;
simple_variables[&quot;name&quot;] = std::string(&quot;小明&quot;);
simple_variables[&quot;weather&quot;] = std::string(&quot;晴朗&quot;);
simple_variables[&quot;time&quot;] = std::string(&quot;上午&quot;);
simple_variables[&quot;topic&quot;] = std::string(&quot;学习计划&quot;);
simple_variables[&quot;content&quot;] = std::string(&quot;1. 完成数学作业\n2. 阅读英语文章\n3. 复习历史知识&quot;);

try {
    std::string formatted_simple = ChatUtils::format_inja(simple_template, simple_variables);
    std::cout &lt;&lt; formatted_simple &lt;&lt; &quot;\n&quot;;
} catch (const std::exception&amp; e) {
    std::cerr &lt;&lt; &quot;格式化错误: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
}
</code></pre> <p><strong>输出结果：</strong></p> <pre><code>你好，小明！

今天是一个晴朗的上午。

根据你的学习计划，我为你准备了以下内容：

1. 完成数学作业
2. 阅读英语文章
3. 复习历史知识

希望这些信息对你有帮助！
</code></pre> <h3 id=2-deepsearchcpp>示例2：总结格式化（参考 deepsearch.cpp）</h3> <p>这个示例展示了如何构建复杂的提示词模板，适用于多轮迭代的总结场景：</p> <pre><code class=language-c++>std::string summary_template = R&quot;(
任务

需要你根据信息围绕主题进行总结。主题：`{{topic}}`

工作流

1、仔细阅读所有信息，结合主题阅读理解，充分理解上下文。

2、选出跟主题相关的内容，对选出内容进行总结。

3、如果主题是问题类的，需要总结推理出相关答案，否则正常根据主题进行总结即可。

要求

- 要求字数不能少于 {{min_words}} 字，必须尽可能多。

- 总结的内容必须是信息里面的内容，不能自己发挥，尤其是时间之类的信息。

- 总结的内容必须要点足够全面。

- 逻辑连贯，语句通顺。

- 直接以 markdown 格式给出最后结果。

需要总结的信息

```{{summary_search}}```
)&quot;;

std::unordered_map&lt;std::string, std::any&gt; summary_variables;
summary_variables[&quot;topic&quot;] = std::string(&quot;人工智能的发展历史&quot;);
summary_variables[&quot;min_words&quot;] = 3500;

// 模拟多轮迭代的总结内容
std::vector&lt;std::string&gt; all_iteration_summary = {
    &quot;第一轮搜索：人工智能概念最早由约翰·麦卡锡在1956年提出。&quot;,
    &quot;第二轮搜索：深度学习技术在2010年代取得了突破性进展。&quot;,
    &quot;第三轮搜索：大语言模型如GPT系列在2020年代引起了广泛关注。&quot;
};

// 将多个总结用分隔符连接
std::string all_iteration_summary_str;
for (size_t i = 0; i &lt; all_iteration_summary.size(); ++i) {
    all_iteration_summary_str += all_iteration_summary[i];
    if (i &lt; all_iteration_summary.size() - 1) {
        all_iteration_summary_str += &quot;\n---\n&quot;;
    }
}
summary_variables[&quot;summary_search&quot;] = all_iteration_summary_str;

try {
    std::string formatted_summary = ChatUtils::format_inja(summary_template, summary_variables);
    std::cout &lt;&lt; formatted_summary &lt;&lt; &quot;\n&quot;;
} catch (const std::exception&amp; e) {
    std::cerr &lt;&lt; &quot;格式化错误: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
}
</code></pre> <p><strong>输出结果：</strong></p> <pre><code>任务

需要你根据信息围绕主题进行总结。主题：`人工智能的发展历史`

工作流

1、仔细阅读所有信息，结合主题阅读理解，充分理解上下文。

2、选出跟主题相关的内容，对选出内容进行总结。

3、如果主题是问题类的，需要总结推理出相关答案，否则正常根据主题进行总结即可。

要求

- 要求字数不能少于 3500 字，必须尽可能多。

- 总结的内容必须是信息里面的内容，不能自己发挥，尤其是时间之类的信息。

- 总结的内容必须要点足够全面。

- 逻辑连贯，语句通顺。

- 直接以 markdown 格式给出最后结果。

需要总结的信息

```第一轮搜索：人工智能概念最早由约翰·麦卡锡在1956年提出。
---
第二轮搜索：深度学习技术在2010年代取得了突破性进展。
---
第三轮搜索：大语言模型如GPT系列在2020年代引起了广泛关注。```
</code></pre> <h3 id=3>示例3：使用不同类型的变量</h3> <p>Inja 模板支持多种数据类型的变量，包括字符串、整数、浮点数、布尔值和容器类型：</p> <pre><code class=language-c++>std::string mixed_template = R&quot;(
用户信息：

- 姓名: {{name}}
- 年龄: {{age}}
- 是否VIP: {{is_vip}}
- 积分: {{points}}
- 标签: {{tags}}
)&quot;;

std::unordered_map&lt;std::string, std::any&gt; mixed_variables;
mixed_variables[&quot;name&quot;] = std::string(&quot;张三&quot;);
mixed_variables[&quot;age&quot;] = 28;
mixed_variables[&quot;is_vip&quot;] = true;
mixed_variables[&quot;points&quot;] = 1250.5;

std::vector&lt;std::string&gt; tags = {&quot;活跃用户&quot;, &quot;技术爱好者&quot;, &quot;早期用户&quot;};
mixed_variables[&quot;tags&quot;] = tags;

try {
    std::string formatted_mixed = ChatUtils::format_inja(mixed_template, mixed_variables);
    std::cout &lt;&lt; formatted_mixed &lt;&lt; &quot;\n&quot;;
} catch (const std::exception&amp; e) {
    std::cerr &lt;&lt; &quot;格式化错误: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
}
</code></pre> <p><strong>输出结果：</strong></p> <pre><code>用户信息：

- 姓名: 张三
- 年龄: 28
- 是否VIP: true
- 积分: 1250.5
- 标签: 活跃用户, 技术爱好者, 早期用户
</code></pre> <h2 id=_6>完整示例程序</h2> <p>以下是一个完整的示例程序，展示了所有三个示例的使用：</p> <pre><code class=language-c++>#include &lt;chat_utils.h&gt;
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;unordered_map&gt;
#include &lt;any&gt;

int main()
{
    std::cout &lt;&lt; &quot;=== Inja 模板格式化示例 === \n&quot;;

    // 示例1: 简单的上下文格式化
    std::cout &lt;&lt; &quot;【示例1】简单的上下文格式化\n&quot;;
    std::string simple_template = R&quot;(
你好，{{name}}！

今天是一个{{weather}}的{{time}}。

根据你的{{topic}}，我为你准备了以下内容：

{{content}}

希望这些信息对你有帮助！

)&quot;;

    std::unordered_map&lt;std::string, std::any&gt; simple_variables;
    simple_variables[&quot;name&quot;] = std::string(&quot;小明&quot;);
    simple_variables[&quot;weather&quot;] = std::string(&quot;晴朗&quot;);
    simple_variables[&quot;time&quot;] = std::string(&quot;上午&quot;);
    simple_variables[&quot;topic&quot;] = std::string(&quot;学习计划&quot;);
    simple_variables[&quot;content&quot;] = std::string(&quot;1. 完成数学作业\n2. 阅读英语文章\n3. 复习历史知识&quot;);

    try {
        std::string formatted_simple = ChatUtils::format_inja(simple_template, simple_variables);
        std::cout &lt;&lt; formatted_simple &lt;&lt; &quot;\n&quot;;
    } catch (const std::exception&amp; e) {
        std::cerr &lt;&lt; &quot;格式化错误: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
    }

    std::cout &lt;&lt; &quot;\n&quot; &lt;&lt; std::string(50, '-') &lt;&lt; &quot;\n&quot;;

    // 示例2: 类似 deepsearch.cpp 的总结格式化
    std::cout &lt;&lt; &quot;【示例2】总结格式化（参考 deepsearch.cpp）\n&quot;;
    std::string summary_template = R&quot;(
任务

需要你根据信息围绕主题进行总结。主题：`{{topic}}`

工作流

1、仔细阅读所有信息，结合主题阅读理解，充分理解上下文。

2、选出跟主题相关的内容，对选出内容进行总结。

3、如果主题是问题类的，需要总结推理出相关答案，否则正常根据主题进行总结即可。

要求

- 要求字数不能少于 {{min_words}} 字，必须尽可能多。

- 总结的内容必须是信息里面的内容，不能自己发挥，尤其是时间之类的信息。

- 总结的内容必须要点足够全面。

- 逻辑连贯，语句通顺。

- 直接以 markdown 格式给出最后结果。

需要总结的信息

```{{summary_search}}```

)&quot;;

    std::unordered_map&lt;std::string, std::any&gt; summary_variables;
    summary_variables[&quot;topic&quot;] = std::string(&quot;人工智能的发展历史&quot;);
    summary_variables[&quot;min_words&quot;] = 3500;

    // 模拟多轮迭代的总结内容
    std::vector&lt;std::string&gt; all_iteration_summary = {
        &quot;第一轮搜索：人工智能概念最早由约翰·麦卡锡在1956年提出。&quot;,
        &quot;第二轮搜索：深度学习技术在2010年代取得了突破性进展。&quot;,
        &quot;第三轮搜索：大语言模型如GPT系列在2020年代引起了广泛关注。&quot;
    };

    // 将多个总结用分隔符连接
    std::string all_iteration_summary_str;
    for (size_t i = 0; i &lt; all_iteration_summary.size(); ++i) {
        all_iteration_summary_str += all_iteration_summary[i];
        if (i &lt; all_iteration_summary.size() - 1) {
            all_iteration_summary_str += &quot;\n---\n&quot;;
        }
    }
    summary_variables[&quot;summary_search&quot;] = all_iteration_summary_str;

    try {
        std::string formatted_summary = ChatUtils::format_inja(summary_template, summary_variables);
        std::cout &lt;&lt; formatted_summary &lt;&lt; &quot;\n&quot;;
    } catch (const std::exception&amp; e) {
        std::cerr &lt;&lt; &quot;格式化错误: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
    }

    std::cout &lt;&lt; &quot;\n&quot; &lt;&lt; std::string(50, '-') &lt;&lt; &quot;\n&quot;;

    // 示例3: 使用不同类型的变量
    std::cout &lt;&lt; &quot;【示例3】使用不同类型的变量\n&quot;;
    std::string mixed_template = R&quot;(
用户信息：

- 姓名: {{name}}
- 年龄: {{age}}
- 是否VIP: {{is_vip}}
- 积分: {{points}}
- 标签: {{tags}}

)&quot;;

    std::unordered_map&lt;std::string, std::any&gt; mixed_variables;
    mixed_variables[&quot;name&quot;] = std::string(&quot;张三&quot;);
    mixed_variables[&quot;age&quot;] = 28;
    mixed_variables[&quot;is_vip&quot;] = true;
    mixed_variables[&quot;points&quot;] = 1250.5;

    std::vector&lt;std::string&gt; tags = {&quot;活跃用户&quot;, &quot;技术爱好者&quot;, &quot;早期用户&quot;};
    mixed_variables[&quot;tags&quot;] = tags;

    try {
        std::string formatted_mixed = ChatUtils::format_inja(mixed_template, mixed_variables);
        std::cout &lt;&lt; formatted_mixed &lt;&lt; &quot;\n&quot;;
    } catch (const std::exception&amp; e) {
        std::cerr &lt;&lt; &quot;格式化错误: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
    }

    std::cout &lt;&lt; &quot;\n=== 示例完成 ===\n&quot;;

    return 0;
}
</code></pre> <h2 id=_7>支持的变量类型</h2> <p><code>ChatUtils::format_inja</code> 函数支持以下类型的变量：</p> <ul> <li><strong>字符串</strong> (<code>std::string</code>)：最常用的类型，直接替换到模板中</li> <li><strong>整数</strong> (<code>int</code>, <code>long</code>, <code>long long</code> 等)：自动转换为字符串</li> <li><strong>浮点数</strong> (<code>float</code>, <code>double</code>)：自动转换为字符串</li> <li><strong>布尔值</strong> (<code>bool</code>)：转换为 "true" 或 "false"</li> <li><strong>容器类型</strong> (<code>std::vector&lt;T&gt;</code>)：自动转换为逗号分隔的字符串</li> </ul> <h2 id=_8>错误处理</h2> <p>当模板格式化失败时，<code>format_inja</code> 函数会抛出 <code>std::exception</code> 异常。建议使用 <code>try-catch</code> 块捕获异常并进行适当的错误处理：</p> <pre><code class=language-c++>try {
    std::string result = ChatUtils::format_inja(template_str, variables);
    // 使用格式化后的结果
} catch (const std::exception&amp; e) {
    std::cerr &lt;&lt; &quot;模板格式化错误: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
    // 处理错误情况
}
</code></pre> <h2 id=_9>最佳实践</h2> <ol> <li> <p><strong>使用原始字符串字面量</strong>：使用 <code>R"(...)"</code> 语法定义模板字符串，可以保留换行和特殊字符，提高可读性</p> </li> <li> <p><strong>变量命名规范</strong>：使用有意义的变量名，便于理解和维护</p> </li> <li> <p><strong>错误处理</strong>：始终使用 <code>try-catch</code> 块捕获可能的异常</p> </li> <li> <p><strong>模板复用</strong>：将常用的模板定义为常量或函数，便于复用</p> </li> <li> <p><strong>类型安全</strong>：确保变量类型与模板中的使用场景匹配</p> </li> </ol> <h2 id=_10>应用场景</h2> <p>Inja 模板格式化在 HADK 框架中常用于以下场景：</p> <ul> <li><strong>提示词构建</strong>：动态构建 LLM 的提示词，根据上下文和任务需求生成不同的提示</li> <li><strong>消息格式化</strong>：格式化用户消息、系统消息等</li> <li><strong>总结生成</strong>：构建多轮迭代的总结提示词</li> <li><strong>工具调用参数</strong>：动态生成工具调用的参数描述</li> </ul> <h2 id=_11>参考资源</h2> <ul> <li><a href=https://github.com/pantor/inja>Inja 官方文档</a></li> <li><a href=../ >HADK 框架文档</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 LATC CTOO Lenovo Group </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.e71a0d61.min.js></script> </body> </html>